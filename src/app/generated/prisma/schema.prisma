generator client {
  provider = "prisma-client-js"
  output   = "../src/app/generated/prisma"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id        String   @id @default(cuid())
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  email     String?  @unique
  password  String
  name      String
  image     String?
  role      Role     @default(STUDENT)

  isDisabled Boolean @default(false)

  teacherId Int?     @unique
  teacher   Teacher? @relation(fields: [teacherId], references: [teacherId])

  studentId Int?     @unique
  student   Student? @relation(fields: [studentId], references: [studentId])

  @@index([studentId])
}

model Teacher {
  teacherId   Int      @id @default(autoincrement())
  name        String
  phone       String   @unique
  email       String   @unique
  subject     String?
  designation String?
  department  String?
  joinedAt    DateTime @default(now())
  dob         DateTime
  gender      String
  address     String?
  bloodGroup  String?
  profileImg  String?

  user      User?
  schedules WeeklySchedule[]
  Subject   Subject?         @relation(fields: [subjectId], references: [id])
  subjectId String?
}

model Student {
  studentId    Int      @id @unique @default(autoincrement())
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  fullName     String
  gender       String
  dob          DateTime
  doa          DateTime
  mobile       String
  bloodGroup   String?
  studentImg   String?
  address      String?
  others       String?
  fatherName   String
  motherName   String
  fatherPhone  String
  gurdianName  String
  relation     String
  gurdianPhone String

  enrollments Enrollment[]
  results     Result[]

  User User?
}

model AcademicYear {
  id        String   @id @default(cuid())
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  year      Int      @unique
  current   Boolean  @default(false)

  enrollments Enrollment[]
  results     Result[]
}

model Class {
  id          String   @id @default(cuid())
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  className   String   @unique
  sectionName String[]

  enrollments  Enrollment[]
  results      Result[]
  Event        Event[]
  Announcement Announcement[]
  schedules    WeeklySchedule[]
}

model Enrollment {
  id        String   @id @default(cuid())
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  student   Student  @relation(fields: [studentId], references: [studentId])
  studentId Int

  academicYear   AcademicYear @relation(fields: [academicYearId], references: [id])
  academicYearId String

  class   Class  @relation(fields: [classId], references: [id])
  classId String

  section   String
  status    EnrollmentStatus
  classRoll Int

  @@index([studentId])
}

model Result {
  id         String       @id @default(cuid())
  createdAt  DateTime     @default(now())
  updatedAt  DateTime     @updatedAt
  gpa        Float?
  status     ReusltStatus
  type       ExamType
  totalMarks Int
  position   Int?

  academicYear   AcademicYear @relation(fields: [academicYearId], references: [id])
  academicYearId String

  class   Class  @relation(fields: [classId], references: [id], onDelete: Cascade)
  classId String

  section String

  student   Student @relation(fields: [studentId], references: [studentId], onDelete: Cascade)
  studentId Int

  subjects Json[]

  @@index([studentId])
}

model Event {
  id        String   @id @default(cuid())
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  title     String
  data      DateTime
  startTime DateTime
  endTime   DateTime
  class     Class?   @relation(fields: [classId], references: [id])
  classId   String?
}

model Announcement {
  id        String   @id @default(cuid())
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  title     String
  date      DateTime
  class     Class?   @relation(fields: [classId], references: [id])
  classId   String?
}

model Subject {
  id        String           @id @default(cuid())
  name      String
  teachers  Teacher[]
  schedules WeeklySchedule[]
}

model WeeklySchedule {
  id String @id @default(cuid())

  class   Class  @relation(fields: [classId], references: [id])
  classId String

  section String // NEW: Add this field to link to a specific section

  teacher   Teacher @relation(fields: [teacherId], references: [teacherId])
  teacherId Int

  subject   Subject @relation(fields: [subjectId], references: [id])
  subjectId String

  dayOfWeek Int // 0 = Sunday, ..., 6 = Saturday
  startTime String // e.g., "08:00"
  endTime   String // e.g., "08:45"
}

model Notice {
  id        String   @id @default(cuid())
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  title     String
  file      String
}

enum Role {
  STUDENT
  ADMIN
  TEACHER
}

enum ReusltStatus {
  PASSED
  FAILED
}

enum ExamType {
  MIDTERM
  FINAL
}

enum EnrollmentStatus {
  ADMITTED
  PROMOTED
  REPEATED
  LEFT
}
